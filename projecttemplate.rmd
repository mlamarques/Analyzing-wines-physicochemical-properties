# Analyzing wines physicochemical properties by Marcos Alves

***


```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using in your analysis in this code
# chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk. This
# prevents the code from displaying in the knitted HTML output. You should set
# echo=FALSE for all code chunks in your file, unless it makes sense for your
# report to show the code that generated a particular plot.

# The other parameters for "message" and "warning" should also be set to FALSE
# for other code chunks once you have verified that each plot comes out as you
# want it to. This will clean up the flow of your report.

library(ggplot2)
library(GGally)
library(tidyr)
library(purrr)
library(gridExtra)

```

```{r echo=FALSE, Load_the_Data}
# Load the Data
white <- read.csv("winequality-white.csv", sep = ";")
red <- read.csv("winequality-red.csv", sep = ";")
```
# Introduction

In this project, I'm trying to identify what are the characteristics of good wine.

I'm using the public dataset **Wine Quality Datasets** - P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis. Modeling wine preferences by data mining from physicochemical properties. In Decision Support Systems, Elsevier, 47(4):547-553, 2009.
It contains two datasets, one for red wines and another for white wines.

  [Here](http://www3.dsi.uminho.pt/pcortez/wine/) you can find more information and the files used in this project.

The dataset uses the measurements of 13 chemical constituents from [Vinho Verde Wines](http://www.vinhoverde.pt/), a wine brand from the northwest region of Portugal.

## Variables
- Fixed acidity: g(tartaric acid)/dm3
- Volatile acidity: g(acetic acid)/dm3
- Citric acid: g/dm3
- Residual sugar: g/dm3
- Chlorides: g(sodium chloride)/dm3 the amount of salt in the wine
- Free sulfur dioxide: mg/dm3
- Total sulfur dioxide: mg/dm3
- Density: g/cm3
- pH
- Sulphates:g(potassium sulphate)/dm3
- Alcohol: % vol.
- Quality:  evaluated by a minimum of three sensory assessors (using blind tastes), classified in a scale from 0 (very bad) to 10 (excellent). The final sensory score is the median of these evaluations.

# Considerations

Wine certification assessed by sensory tests is very subjective, so it might be hard to find a clear correlation of the variables with the quality of the wine.
This is an interesting [Vox video](https://www.youtube.com/watch?v=mVKuCbjFfIY) about wines taste and price.

For this project, I will use the white wine (winequality-white.csv) dataset.

# Data Analysis
## White Wine Dataset


```{r echo=FALSE, summary}

summary(white)

```
Dataset summary

```{r echo=FALSE, Structure}

str(white)

```
This is the structure of the dataset

```{r echo=FALSE, Head}

head(white)

```
These are the first 6 rows of each variable

```{r echo=FALSE, correlation_quality}

cor(white[,2:12], white$quality)

```
The correlation between each variable and quality 


```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots}

ggplot(aes(x = quality), data = white) +
  geom_bar(fill = "#8989ff") +
  geom_vline(xintercept = median(white$quality), color = "red")

```

Most wines have a quality of 6 and the best variable for quality correlation is alcohol.


## Alcohol

```{r echo=FALSE, message=FALSE, warning=FALSE, hist_alcohol}

ggplot(aes(x = alcohol), data = white) +
  geom_bar(fill = "#1ab385", binwidth = .05) +
  geom_vline(xintercept = median(white$alcohol), color = "orange")

```

The histogram of alcohol

> Let's create a new column with the quality values as labels so we can create a boxplot by quality.

```
white$scale <- as.factor(white$quality)
```
```{r echo=FALSE, message=FALSE, warning=FALSE, alcohol}

white$scale <- as.factor(white$quality)

ggplot(aes(factor(quality), 
            alcohol), 
        data = white) +
  geom_jitter( alpha = .3)  +
  geom_boxplot( alpha = .5,color = 'blue')+
  stat_summary(fun.y = "mean", 
               geom = "point", 
               color = "red", 
               shape = 8, 
               size = 4) +
  xlab("Quality")

```

> There is a clear indication of the correlation of alcohol and quality above the score of 6 


### Alcohol x Quality:
```{r echo=FALSE, message=FALSE, warning=FALSE, alcohol2}

ggplot(aes(x = scale, y = alcohol), data = white) +
    geom_point(position = 'jitter', color = "#46003d", alpha = 1/5) +
    geom_smooth(method='lm', aes(group = 1), color = "cyan") +
    xlab("Wine Quality") +
    ylab("Alcohol")

```

### Alcohol and Quality Correlation:

```{r echo=FALSE}
cor(white$alcohol, white$quality)

```

## ggpairs

using the ggpair function we can have a look on all the relations between the variables

```{r echo=FALSE,  message=FALSE, warning=FALSE, ggpairs}
#space

set.seed(1990)
ggpairs(white[sample.int(nrow(white), 1000), ]) ##TAKES SOME TIME DO RUN

```

## Bivariate

### Citric Acid x Quality:
```{r echo=FALSE, message=FALSE, warning=FALSE, citric.acid}

ggplot(aes(factor(quality), 
            citric.acid), 
        data = white) +
  geom_jitter( alpha = .3)  +
  geom_boxplot( alpha = .5,color = 'green')+
  stat_summary(fun.y = "mean", 
               geom = "point", 
               color = "blue", 
               shape = 8, 
               size = 4) +
  xlab("Quality") +
  ylim(0, 1)

```

Most values of Citric Acid are in the same range, but in the score of 9 it seem to be a bit higher.

### Free sulfur dioxide x Quality:
```{r echo=FALSE, message=FALSE, warning=FALSE, freesulfurdioxide}

ggplot(aes(factor(quality), 
            free.sulfur.dioxide), 
        data = white) +
  geom_jitter( alpha = .3, color = "orange")  +
  geom_boxplot( alpha = .5,color = 'blue')+
  stat_summary(fun.y = "mean", 
               geom = "point", 
               color = "red", 
               shape = 8, 
               size = 4) +
  xlab("Quality") +
  ylim(0,150)

```

Values above the quality of four are close to 40. There are a few outliers with hight values of free SO2 for the quality of 3, so I ajust the y axis to have a better view where most of the values are. It also seems that the value of free SO2 has a small decrease above the quality of 8.

### pH x Quality:
```{r echo=FALSE, message=FALSE, warning=FALSE, pH}

ggplot(data=white, aes(x = scale, y = pH)) +
  geom_jitter( alpha = .3, color = "orange")  +
  geom_boxplot( alpha = .5,color = 'blue') +
  stat_summary(fun.y = "mean", 
               geom = "point", 
               color = "red", 
               shape = 8, 
               size = 4) +
  xlab("Quality")

```

There is a slight increase in pH as quality gets higher


pH seems to have some correlation with quality, so let's see what variables might affect it:
```{r echo=FALSE, message=FALSE, warning=FALSE, correlation_pH}

cor(white[,2:12], white$pH)

```

### residual.sugar x pH:
```{r echo=FALSE, message=FALSE, warning=FALSE, residual.sugar_x_pH}

ggplot(aes(x = residual.sugar, y = pH), data = white) +
    geom_point(position = 'jitter', color = "#46003d", alpha = 1/5) +
    geom_smooth(method='lm', aes(group = 1), color = "cyan") +
    xlim(0, 25) +
    xlab("residual sugar") +
    ylab("pH")

```

### citric.acid x pH:
```{r echo=FALSE, message=FALSE, warning=FALSE, citric.acid_x_pH}

ggplot(aes(x = citric.acid, y = pH), data = white) +
    geom_point(position = 'jitter', color = "#46003d", alpha = 1/5) +
    geom_smooth(method='lm', aes(group = 1), color = "cyan") +
    xlab("Citric Acid") +
    ylab("pH")

```


### sulphates x pH:
```{r echo=FALSE, message=FALSE, warning=FALSE, sulphates_x_pH}

ggplot(aes(x = chlorides, y = pH), data = white) +
    geom_point(position = 'jitter', color = "#46003d", alpha = 1/5) +
    geom_smooth(method='lm', aes(group = 1), color = "cyan") +
    xlab("Chlorides") +
    ylab("pH")

```


### Volatile Acidity x Quality:
```{r echo=FALSE, message=FALSE, warning=FALSE, free.sulfur.dioxide}

ggplot(data=white, aes(x = scale, y = volatile.acidity)) +
  geom_jitter( alpha = .3, color = "orange")  +
  geom_boxplot( alpha = .5,color = 'blue')+
  stat_summary(fun.y = "mean", 
               geom = "point", 
               color = "red", 
               shape = 8, 
               size = 4) +
  xlab("Quality")


```

For Volatile Acidity, the values are below 30 for the values of quality above 4.


### Chlorides x Quality:
```{r echo=FALSE, message=FALSE, warning=FALSE, chlorides}

ggplot(data=white, aes(x = scale, y = chlorides)) +
  geom_jitter( alpha = .3, color = "orange")  +
  geom_boxplot( alpha = .5,color = 'blue')+
  stat_summary(fun.y = "mean", 
               geom = "point", 
               color = "red", 
               shape = 8, 
               size = 4) +
  xlab("Quality")

```


### Residual Sugar x Chlorides
```{r echo=FALSE, message=FALSE, warning=FALSE, residual.sugar_x_chlorides}

ggplot(aes(x = chlorides, y = residual.sugar), data = white) +
    geom_point(position = 'jitter', color = "#46003d", alpha = 1/5) +
    geom_smooth(method='lm', aes(group = 1), color = "cyan") +
    xlab("Chlorides") +
    ylab("Residual Sugar") +
  ylim(0, 30)
  

```

## Multivariate

### First Plot

```{r echo=FALSE,  message=FALSE, warning=FALSE, alcohol_x_density}

ggplot(aes(x = alcohol, y = density, color = scale), data = white) + 
  geom_point(position = 'jitter') +
  scale_color_brewer(type = 'div', guide = guide_legend(title = 'Quality')) +
  ylim(0.987,1.003) +
  geom_smooth(method = 'lm', color = 'purple') +
  ggtitle('Density by Alcohol and Quality')

```

In this plot an inverse correlation between density and alcohol, where the best quality tends to have more alcohol and be less dense.


## Second Plot

```{r echo=FALSE,  message=FALSE, warning=FALSE, residual.sugar_x_density}

ggplot(aes(x = residual.sugar, y = density, color = scale), data = white) +
  geom_point(position = 'jitter') +
  scale_color_brewer(type = 'div', guide = guide_legend(title = 'Quality')) +
  xlim(0, 20) +  ylim(0.987,1.002) +
  geom_smooth(method = 'lm', color = 'purple') +
  ggtitle('Density by residual.sugar and Quality')

```

In the second plot, we can see the density and residual.sugar correlation. There is a nice distinction of colors, separate by the smooth line. Most higher quality wines are below the line.


###  Sugar and pH

```{r echo=FALSE,  message=FALSE, warning=FALSE, sugar_pH_quality}

ggplot(aes(x = residual.sugar, y = pH, color = scale), data = white) + 
  geom_point(position = 'jitter') +
  scale_color_brewer(type = 'div', guide = guide_legend(title = 'Quality')) +
  geom_smooth(method = 'lm', color = 'purple') +
  xlim(0, 20) +
  ggtitle('pH by Residual Sugar and Quality')

```


###  Citric Acid and pH

```{r echo=FALSE,  message=FALSE, warning=FALSE, citric.acid_pH_quality}

ggplot(aes(x = citric.acid, y = pH, color = scale), data = white) + 
  geom_point(position = 'jitter') +
  scale_color_brewer(type = 'div', guide = guide_legend(title = 'Quality')) +
  geom_smooth(method = 'lm', color = 'purple') +
  ggtitle('pH by Citric Acid and Quality')
```

Here we can see that there is a interval in the Citric Acid Above 0.25 and below 0.5 where the quality is higher and the pH doesn't interfere so much.

## Third Plot

```{r echo=FALSE,  message=FALSE, warning=FALSE, totalSO2_x_freeSO2}

ggplot(aes(x = free.sulfur.dioxide, y = total.sulfur.dioxide, color = scale), data = white) + 
  geom_point(position = 'jitter') +
  xlim(0, 100) +
  ylim(0, 280) +
  scale_color_brewer(type = 'div', guide = guide_legend(title = 'Quality')) +
  geom_smooth(method = 'lm', color = 'purple') +
  ggtitle('Total.sulfur.dioxide by free.sulfur.dioxide and Quality')

```

In the third plot, we have a small correlation and the quality of wines are more clumped together. But we can distinguish an area where there is a concentration of most green dots, below the smooth line and 25 < free.sulfur.dioxide < 50. 

### Fourth Plot

```{r echo=FALSE,  message=FALSE, warning=FALSE, alcohol_x_pH}

ggplot(aes(x = alcohol, y = pH, color = scale), data = white) + 
  geom_point(position = 'jitter') +
  scale_color_brewer(type = 'div', guide = guide_legend(title = 'Quality')) +
 # ylim(0.987,1.003)
  geom_smooth(method = 'lm', color = '#c32148') +
  ggtitle('pH by Alcohol and Quality')

```

In the fourth plot, the correlation between pH and alcohol is almost inexisting, and the quality is guided mainly by the alcohol quantity.

### Fifth Plot

```{r echo=FALSE,  message=FALSE, warning=FALSE, density_x_pH}

ggplot(aes(x = density, y = pH, color = scale), data = white) + 
  geom_point(position = 'jitter') +
  scale_color_brewer(type = 'div', guide = guide_legend(title = 'Quality')) +
  xlim(0.987,1.003) +
  ggtitle('pH by Density and Quality')

```

In this plot we can see againg that pH has almost no effect in the quality of wines.


# Reflection

These are only the most noticeable physical features that could influence the quality of white wines found on this dataset. There are many other variables that could have an influence on the quality of a wine. I used the ggpairs function to help me find the most relevant features.

Even though the dataset is not so large and wine quality classification is very subjective, there are some correlations between the physicochemical properties that we can notice. The most noticeable is the alcohol %. Higher quality wines have a higher percentage of alcohol, which is correlated with lower density and a lower residual sugar proportion. All of these features must have a considerable impact on the color, smell, and taste of the wine.

In addition to this project, it would be interesting to use some machine learning algorithm to analyze this dataset and also analyze the red wine dataset for comparison.
