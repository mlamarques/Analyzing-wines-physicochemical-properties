# Analyzing wines physicochemical properties by Marcos Alves

***


```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using in your analysis in this code
# chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk. This
# prevents the code from displaying in the knitted HTML output. You should set
# echo=FALSE for all code chunks in your file, unless it makes sense for your
# report to show the code that generated a particular plot.

# The other parameters for "message" and "warning" should also be set to FALSE
# for other code chunks once you have verified that each plot comes out as you
# want it to. This will clean up the flow of your report.

library(ggplot2)
library(GGally)
library(tidyr)
library(purrr)
library(gridExtra)

```

```{r echo=FALSE, Load_the_Data}
# Load the Data
white <- read.csv("winequality-white.csv", sep = ";")
red <- read.csv("winequality-red.csv", sep = ";")
```
# Introduction

In this project, I'm trying to identify what are the characteristics of good wine.

I'm using the public dataset **Wine Quality Datasets** - P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis. Modeling wine preferences by data mining from physicochemical properties. In Decision Support Systems, Elsevier, 47(4):547-553, 2009.
It contains two datasets, one for red wines and another for white wines.

  [Here](http://www3.dsi.uminho.pt/pcortez/wine/) you can find more information and the files used in this project.

The dataset uses the measurements of 13 chemical constituents from [Vinho Verde Wines](http://www.vinhoverde.pt/), a wine brand from the northwest region of Portugal.

## Variables
- Fixed acidity: g(tartaric acid)/dm3
- Volatile acidity: g(acetic acid)/dm3
- Citric acid: g/dm3
- Residual sugar: g/dm3
- Chlorides: g(sodium chloride)/dm3 the amount of salt in the wine
- Free sulfur dioxide: mg/dm3
- Total sulfur dioxide: mg/dm3
- Density: g/cm3
- pH
- Sulphates:g(potassium sulphate)/dm3
- Alcohol: % vol.
- Quality:  evaluated by a minimum of three sensory assessors (using blind tastes), classified in a scale from 0 (very bad) to 10 (excellent). The final sensory score is the median of these evaluations.

# Considerations

Wine certification assessed by sensory tests is very subjective, so it might be hard to find a clear correlation of the variables with the quality of the wine.
This is an interesting [Vox video](https://www.youtube.com/watch?v=mVKuCbjFfIY) about wines taste and price.

For this project, I will use the white wine (winequality-white.csv) dataset.

# Data Analysis
## White Wine Dataset


```{r echo=FALSE, summary}

summary(white)

```
Dataset summary

```{r echo=FALSE, Structure}

str(white)

```
This is the structure of the dataset

```{r echo=FALSE, Head}

head(white)

```
This is the first 5 rows of each variable

```{r echo=FALSE, correlation quality}

cor(white[,2:12], white$quality)

```
The correlation between each variable and quality 

```{r echo=FALSE, Density}

white %>%
  keep(is.numeric) %>%                     # Keep only numeric columns
  gather() %>%                             # Convert to key-value pairs
  ggplot(aes(value)) +                     # Plot the values
  facet_wrap(~ key, scales = "free") +   # In separate panels
  geom_density() 

```
The density of all the variable

```{r echo=FALSE, Univariate_Plots}

ggplot(aes(x = quality), data = white) +
  geom_bar(fill = "#8989ff") +
  geom_vline(xintercept = median(white$quality), color = "red")

```

Most wines have a quality of 6 and the best variable for quality correlation is alcohol.


## Alcohol

```{r echo=FALSE, hist_alcohol}

ggplot(aes(x = alcohol), data = white) +
  geom_bar(fill = "#1ab385", binwidth = .05) +
  geom_vline(xintercept = median(white$alcohol), color = "orange")

```

The histogram of alcohol

### Let's create a new column with the quality values as labels so we can create a boxplot by quality.
```
white$scale <- as.factor(white$quality)
```
```{r echo=FALSE, message=FALSE, warning=FALSE, alcohol}

white$scale <- as.factor(white$quality)

ggplot(data=white, aes(x = scale, y = alcohol)) +
  geom_boxplot() +
  xlab("Quality")

```

> There is a clear indication of the correlation of alcohol and quality above the score of 6 


### Alcohol x Quality:
```{r echo=FALSE, message=FALSE, warning=FALSE, alcohol2}

ggplot(aes(x = scale, y = alcohol), data = white) +
    geom_point(position = 'jitter', color = "#46003d", alpha = 1/5) +
    geom_smooth(method='lm', aes(group = 1), color = "cyan") +
    xlab("Wine Quality") +
    ylab("Alcohol")

```

### Alcohol and Quality Correlation:

```{r echo=FALSE}
cor(white$alcohol, white$quality)

```

## ggpairs

using the ggpair function we can have a look on all the relations between the variables

```{r echo=FALSE,  message=FALSE, warning=FALSE, ggpairs}
#space

set.seed(1990)
ggpairs(white[sample.int(nrow(white), 1000), ]) ##TAKES SOME TIME DO RUN

```

## Bivariate

### pH x Quality:
```{r echo=FALSE, message=FALSE, warning=FALSE, pH}

ggplot(data=white, aes(x = scale, y = pH)) +
  geom_boxplot() +
  xlab("Quality")

```
There is a slight increase in pH as quality gets higher

### Free sulfur dioxide:
```{r echo=FALSE, message=FALSE, warning=FALSE, free.sulfur.dioxide}

ggplot(data=white, aes(x = scale, y = free.sulfur.dioxide)) +
  geom_boxplot() +
  ylim(0,150) +
  xlab("Free sulfur dioxide")

```
The values of this variable seems to be relatively close across the ratings above 4, slightly lower for the highest quality.

### Chlorides:
```{r echo=FALSE, message=FALSE, warning=FALSE, chlorides}

ggplot(data=white, aes(x = scale, y = chlorides)) +
  geom_boxplot() +
  
  xlab("Chlorides")

```
It doesn't seem to have some good distinction between the variables.

```{r echo=FALSE, hist_chlorides}

ggplot(aes(x = chlorides), data = white) +
  geom_bar(fill = "#1ab385", binwidth = .001) +
  geom_vline(xintercept = median(white$chlorides), color = "orange")

```
This variable has low variance, so I'm not using it for the analysis of quality.

## Multivariate

### First Plot

```{r echo=FALSE,  message=FALSE, warning=FALSE, alcohol_x_density}

ggplot(aes(x = alcohol, y = density, color = scale), data = white) + 
  geom_point(position = 'jitter') +
  scale_color_brewer(type = 'div', guide = guide_legend(title = 'Quality')) +
  ylim(0.987,1.003) +
  geom_smooth(method = 'lm', color = 'purple') +
  ggtitle('Density by Alcohol and Quality')

```

In this plot an inverse correlation between density and alcohol, where the best quality tends to have more alcohol and be less dense.


## Second Plot

```{r echo=FALSE,  message=FALSE, warning=FALSE, residual.sugar_x_density}

ggplot(aes(x = residual.sugar, y = density, color = scale), data = white) +
  geom_point(position = 'jitter') +
  scale_color_brewer(type = 'div', guide = guide_legend(title = 'Quality')) +
  xlim(0, 20) +  ylim(0.987,1.002) +
  geom_smooth(method = 'lm', color = 'purple') +
  ggtitle('Density by residual.sugar and Quality')

```

In the second plot, we can see the density and residual.sugar correlation. There is a nice distinction of colors, separate by the smooth line. Most higher quality wines are below the line.

## Third Plot

```{r echo=FALSE,  message=FALSE, warning=FALSE, totalSO2_x_freeSO2}

ggplot(aes(x = free.sulfur.dioxide, y = total.sulfur.dioxide, color = scale), data = white) + 
  geom_point(position = 'jitter') +
  xlim(0, 100) +
  ylim(0, 280) +
  scale_color_brewer(type = 'div', guide = guide_legend(title = 'Quality')) +
  geom_smooth(method = 'lm', color = 'purple') +
  ggtitle('Total.sulfur.dioxide by free.sulfur.dioxide and Quality')

```

In the third plot, we have a small correlation and the quality of wines are more clumped together. But we can distinguish an area where there is a concentration of most green dots, below the smooth line and 25 < free.sulfur.dioxide < 50. 

### Fourth Plot

```{r echo=FALSE,  message=FALSE, warning=FALSE, alcohol_x_pH}

ggplot(aes(x = alcohol, y = pH, color = scale), data = white) + 
  geom_point(position = 'jitter') +
  scale_color_brewer(type = 'div', guide = guide_legend(title = 'Quality')) +
 # ylim(0.987,1.003)
  geom_smooth(method = 'lm', color = '#c32148') +
  ggtitle('pH by Alcohol and Quality')

```
In the fourth plot, the correlation between pH and alcohol is almost inexisting, and the quality is guided mainly by the alcohol quantity.


# Reflection

These are only the most noticeable physical features that could influence the quality of white wines found on this dataset. There are many other variables that could have an influence on the quality of a wine. I used the ggpairs function to help me find the most relevant features.

Even though the dataset is not so large and wine quality classification is very subjective, there are some correlations between the physicochemical properties that we can notice. The most noticeable is the alcohol %. Higher quality wines have a higher percentage of alcohol, which is correlated with lower density and a lower residual sugar proportion. All of these features must have a considerable impact on the color, smell, and taste of the wine.

In addition to this project, it would be interesting to use some machine learning algorithm to analyze this dataset and also analyze the red wine dataset for comparison.
